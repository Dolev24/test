<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>×”×›×ª×¨ ×©×œ×š</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Assistant', sans-serif; scroll-behavior: smooth; }

        .hover-effect { transition: transform 0.28s ease-in-out, box-shadow 0.28s ease-in-out; }
        .hover-effect:hover:not(:has(.quantity-controls:hover)) {
            transform: translateY(-6px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1), 0 6px 6px rgba(0,0,0,0.12);
        }
        .no-hover { transform: none !important; box-shadow: none !important; }

        /* prevent click/tap highlight / outlines that cause layout shifts */
        button, a { -webkit-tap-highlight-color: transparent; outline: none; }
        button:focus, a:focus { outline: none; }

        #cart-popup { z-index: 50; }
        .cart-enter { animation: cart-enter-anim 0.4s ease-out; }
        @keyframes cart-enter-anim {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal-overlay { z-index: 9998; }
        .modal-box { z-index: 9999; }

        .split-parent { display: inline-block; overflow: hidden; }
        .split-char { display: inline-block; white-space: pre; will-change: transform, opacity; }

        /* Gradual blur styles */
        .gradual-blur { isolation: isolate; position: absolute; left: 0; right: 0; pointer-events: none; overflow: hidden; z-index: 0; }
        .gradual-blur-inner { position: relative; width: 100%; height: 100%; display: flex; }
        .gradual-blur-inner > div { flex: 1; transform-origin: center; background: linear-gradient(180deg, rgba(255,255,255,0) 0%, rgba(0,0,0,0.06) 100%); }
        .gradual-blur-fixed { position: fixed !important; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; z-index: 1000; }

        /* Add to your existing CSS */
        .gradual-blur {
          backface-visibility: hidden;
          -webkit-backface-visibility: hidden;
        }

        .gradual-blur-inner > div {
          will-change: opacity, backdrop-filter;
          transform: translateZ(0);
        }

        @supports not (backdrop-filter: blur(1px)) {
          .gradual-blur-inner > div {
            background: rgba(0, 0, 0, 0.06);
            opacity: 0.5;
          }
        }

        /* Make hero content above the blur */
        #hero > .hero-content * { position: relative; z-index: 2; }

        /* Product card wishlist button */
        .product-card { position: relative; overflow: hidden; transform: translateZ(0); will-change: transform; }
        .wishlist-btn {
          position: absolute;
          top: 0.5rem;
          left: 0.5rem; /* left because dir=rtl; visually top-right in RTL */
          background: rgba(255,255,255,0.95);
          border-radius: 9999px;
          width: 36px;
          height: 36px;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          box-shadow: 0 2px 6px rgba(0,0,0,0.08);
          cursor: pointer;
          transition: transform .12s ease, background .12s ease, box-shadow .12s ease;
          z-index: 6;
        }
        .wishlist-btn:hover { transform: scale(1.05); }
        .wishlist-btn .heart { color: #94a3b8; font-size: 18px; line-height:1; user-select:none; }
        .wishlist-btn.filled { background: rgba(255,255,255,0.98); }
        .wishlist-btn.filled .heart { color: #ef4444; }

        /* Reserve card-actions height to avoid jumps when swapping Add -> qty controls */
        .card-actions { min-height: 46px; display:flex; align-items:center; justify-content:center; gap:0.5rem; }

        /* Header layout: explicit positioned left/right + centered crown */
        header { position: relative; }
        header .header-row {
          display: grid;
          grid-template-columns: 1fr auto 1fr;
          align-items: center;
          padding: 0 1rem;
          height: 56px;
          position: relative;
        }
        header .nav-right {
          grid-column: 1; /* Place nav on right in RTL */
          display: flex;
          gap: 2rem;
          align-items: center;
          justify-content: flex-start;
        }
        header .logo-center {
          grid-column: 2;
          position: relative;
          display: flex;
          align-items: center;
          justify-content: center;
        }
        header .utils-left {
          grid-column: 3; /* Place utils on left in RTL */
          display: flex;
          align-items: center;
          gap: 1rem;
          justify-content: flex-end;
        }

        /* search wrapper so we can add wishlist icon next to it */
        .search-wrap {
          position: relative;
          display: inline-flex;
          align-items: center;
        }
        .search-wrap input {
          width: 280px;
          padding: 0.5rem 2.5rem 0.5rem 2.5rem;
          border-radius: 9999px;
        }
        .search-icon {
          position: absolute;
          right: 0.75rem;
          top: 50%;
          transform: translateY(-50%);
          pointer-events: none;
          color: #94a3b8;
        }
        .search-wishlist {
          position: absolute;
          right: -2.5rem; /* Move wishlist icon to visual right */
          top: 50%;
          transform: translateY(-50%);
          display: flex;
          align-items: center;
        }

        /* wishlist badge next to inline icon */
        .inline-wishlist-badge { position: absolute; top: -8px; left: -8px; background:#ef4444; color:white; font-size:10px; width:18px; height:18px; border-radius:999px; display:flex; align-items:center; justify-content:center; z-index:8; }

        /* subtle transition for add-to-cart/qty controls to avoid layout jumps */
        .quantity-controls, .add-to-cart-btn { transition: opacity .12s ease, transform .12s ease; }

        /* make buttons inside cards not trigger parent hover transform */
        .product-card .no-hover { pointer-events: auto; }

        /* Fix animation */
        .product-card {
          transform: translateZ(0);
          transition: transform 0.2s ease-out;
        }

        .product-card:hover {
          transform: translateY(-6px);
        }

        .product-card button {
          transform: none !important;
        }

        /* Fix GSAP animation */
        .split-char {
          opacity: 0;
          transform: translateY(40px);
          display: inline-block;
          white-space: pre;
        }

        /* Silk-like animated background */
        .silk-bg {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          z-index: 0;
          background: linear-gradient(
            45deg,
            rgba(123, 116, 129, 0.4) 0%,
            rgba(123, 116, 129, 0.2) 100%
          );
          overflow: hidden;
          isolation: isolate;
        }

        .silk-bg::before,
        .silk-bg::after {
          content: '';
          position: absolute;
          inset: -50%;
          width: 200%;
          height: 200%;
          background: radial-gradient(
            circle,
            rgba(123, 116, 129, 0.2) 0%,
            rgba(123, 116, 129, 0.1) 50%,
            transparent 100%
          );
          animation: silkFloat 20s linear infinite;
          opacity: 0.7;
          will-change: transform;
        }

        .silk-bg::after {
          animation: silkFloat 15s linear infinite reverse;
          opacity: 0.5;
          filter: blur(2px);
        }

        @keyframes silkFloat {
          0% {
            transform: rotate(0deg) scale(1);
          }
          50% {
            transform: rotate(180deg) scale(1.1);
          }
          100% {
            transform: rotate(360deg) scale(1);
          }
        }

        /* Update existing body background */
        body {
          background: transparent;
        }

        /* Update app container */
        #app {
          position: relative;
          z-index: 1;
          background: rgba(249, 250, 251, 0.9);
          min-height: 100vh;
          display: flex;
          flex-direction: column;
          backdrop-filter: blur(8px);
          -webkit-backdrop-filter: blur(8px);
        }

        /* Add these styles to your existing <style> section */
.mobile-menu-button {
  display: none;
  padding: 0.5rem;
  margin-right: -0.5rem;
}

.mobile-menu {
  display: none;
  position: fixed;
  top: 56px; /* header height */
  right: 0;
  left: 0;
  background: white;
  padding: 1rem;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  transform: translateY(-100%);
  transition: transform 0.3s ease-in-out;
  z-index: 30;
}

.mobile-menu.show {
  transform: translateY(0);
}

/* Update header nav styles */
@media (max-width: 768px) {
  .mobile-menu-button {
    display: block;
  }
  
  .mobile-menu {
    display: block;
  }

  header .nav-right {
    display: none; /* Hide desktop nav */
  }

  .mobile-menu a {
    display: block;
    padding: 0.75rem 1rem;
    font-size: 1.25rem;
    color: #4b5563;
    border-radius: 0.375rem;
  }

  .mobile-menu a:hover {
    background: #f3f4f6;
    color: #4f46e5;
  }

  /* Adjust utils positioning */
  header .utils-left {
    margin-right: auto;
  }

  .search-wrap input {
    width: 200px;
  }
}
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
</head>
<body class="text-gray-800">

<div class="silk-bg"></div>

<div id="app" class="min-h-screen flex flex-col">

  <!-- Header -->
  <header class="bg-white shadow-md sticky top-0 z-40">
    <nav class="container mx-auto px-6 py-2">
      <div class="header-row">
        <!-- Navigation titles on visual right -->
        <div class="nav-right">
          <a href="#" onclick="app.navigateTo('home')" class="text-2xl text-gray-600 hover:text-indigo-600 transition-all duration-200">×“×£ ×”×‘×™×ª</a>
          <a href="#" onclick="app.navigateTo('store')" class="text-2xl text-gray-600 hover:text-indigo-600 transition-all duration-200">×—× ×•×ª</a>
          <a href="#" onclick="app.navigateTo('about')" class="text-2xl text-gray-600 hover:text-indigo-600 transition-all duration-200">××•×“×•×ª</a>
          <a href="#" onclick="app.navigateTo('contact')" class="text-2xl text-gray-600 hover:text-indigo-600 transition-all duration-200">×¦×•×¨ ×§×©×¨</a>
        </div>

        <!-- Centered crown -->
        <div class="logo-center" aria-hidden>
          <div style="font-size:28px;">ğŸ‘‘</div>
        </div>

        <!-- Utils on visual left -->
        <div class="utils-left">
          <div class="search-wrap">
            <input 
              id="search-input" 
              type="text" 
              placeholder="×—×™×¤×•×© ××•×¦×¨×™×..."
              class="border focus:outline-none focus:ring-2 focus:ring-indigo-500"
            />
            <svg class="w-5 h-5 search-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
            <button id="wishlist-inline-btn" class="search-wishlist" onclick="app.navigateTo('wishlist')">
              <span id="wishlist-inline-heart" style="font-size:18px;">â™¡</span>
              <div id="wishlist-badge" class="inline-wishlist-badge" style="display:none;">0</div>
            </button>
          </div>

          <button id="cart-button" class="relative text-gray-600 hover:text-indigo-600 transition-colors duration-200">
            <svg class="w-8 h-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
            </svg>
            <span id="cart-count" class="absolute -top-2 -right-2 bg-indigo-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
          </button>
        </div>
      </div>

      <!-- Mobile menu button -->
      <button 
        id="mobile-menu-button" 
        class="mobile-menu-button text-gray-600 hover:text-indigo-600"
        aria-label="×ª×¤×¨×™×˜"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"/>
        </svg>
      </button>
    </nav>
  </header>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="mobile-menu">
    <a href="#" onclick="app.navigateTo('home')" class="block">×“×£ ×”×‘×™×ª</a>
    <a href="#" onclick="app.navigateTo('store')" class="block">×—× ×•×ª</a>
    <a href="#" onclick="app.navigateTo('about')" class="block">××•×“×•×ª</a>
    <a href="#" onclick="app.navigateTo('contact')" class="block">×¦×•×¨ ×§×©×¨</a>
  </div>

  <!-- Cart Popup -->
  <div id="cart-popup" class="hidden fixed top-20 left-0 ml-4 mt-2 w-80 bg-white rounded-lg shadow-xl border cart-enter">
    <div id="cart-content" class="p-4 max-h-96 overflow-y-auto">
      <p class="text-center text-gray-500">×¡×œ ×”×§× ×™×•×ª ×©×œ×š ×¨×™×§.</p>
    </div>
    <div class="border-t p-4">
      <div class="flex justify-between items-center font-bold text-lg">
        <span>×¡×”"×›:</span>
        <span id="cart-total">â‚ª0.00</span>
      </div>
      <button class="w-full bg-indigo-600 text-white rounded-md py-2 mt-4 hover:bg-indigo-700 transition-colors duration-200">×œ×§×•×¤×”</button>
      <button id="close-cart-button" class="w-full bg-gray-200 text-gray-700 rounded-md py-2 mt-2 hover:bg-gray-300 transition-colors duration-200">×¡×’×•×¨</button>
    </div>
  </div>

  <!-- Main Content area -->
  <main id="main-content" class="flex-grow container mx-auto p-6"></main>

  <!-- Footer -->
  <footer class="bg-white border-t mt-12">
    <div class="container mx-auto px-6 py-8 text-center text-gray-500">
      <p>&copy; 2025 ×”×—× ×•×ª ×©×œ×™. ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª.</p>
      <p class="mt-2">××ª×¨ ×–×” ×”×•× ×“×•×’××” ×©× ×‘× ×ª×” ×œ××˜×¨×” ×™×™×¦×•×’×™×ª.</p>
    </div>
  </footer>
</div>

<!-- Confirmation Modal -->
<div id="confirmation-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center modal-overlay">
  <div class="bg-white rounded-lg p-8 shadow-xl modal-box text-center">
    <p id="modal-message" class="text-lg font-semibold mb-6">Are you sure?</p>
    <div class="flex justify-center space-x-4 space-x-reverse">
      <button id="confirm-button" class="bg-red-600 text-white px-6 py-2 rounded-md hover:bg-red-700">××™×©×•×¨</button>
      <button id="cancel-button" class="bg-gray-300 text-gray-800 px-6 py-2 rounded-md hover:bg-gray-400">×‘×™×˜×•×œ</button>
    </div>
  </div>
</div>

<script>
const app = {
  // state
  currentPage: 'home',
  products: [
    { id: 1, name: '×—×•×œ×¦×ª ×˜×™-×©×™×¨×˜', price: 99.90, image: 'https://placehold.co/400x400/f1f5f9/334155?text=T-Shirt' },
    { id: 2, name: "×’'×™× ×¡ ×§×œ××¡×™", price: 249.90, image: 'https://placehold.co/400x400/e2e8f0/334155?text=Jeans' },
    { id: 3, name: '×©××œ×ª ×§×™×¥', price: 199.50, image: 'https://placehold.co/400x400/f8fafc/334155?text=Dress' },
    { id: 4, name: "×–'×§×˜ ×¢×•×¨", price: 450.00, image: 'https://placehold.co/400x400/e2e8f0/334155?text=Jacket' },
    { id: 5, name: '×¡×•×•×“×¨ ×¦××¨', price: 180.00, image: 'https://placehold.co/400x400/f1f5f9/334155?text=Sweater' },
    { id: 6, name: '×›×•×‘×¢ ×‘×™×™×¡×‘×•×œ', price: 79.00, image: 'https://placehold.co/400x400/f8fafc/334155?text=Cap' },
    { id: 7, name: '××›× ×¡×™×™× ×§×¦×¨×™×', price: 120.00, image: 'https://placehold.co/400x400/e2e8f0/334155?text=Shorts' },
    { id: 8, name: '× ×¢×œ×™ ×¡×¤×•×¨×˜', price: 320.00, image: 'https://placehold.co/400x400/f1f5f9/334155?text=Shoes' },
  ],
  cart: [],
  wishlist: [], // store wishlist product ids
  searchTerm: '',
  confirmCallback: null,

  init() {
    this.mainContent = document.getElementById('main-content');
    this.searchInput = document.getElementById('search-input');
    this.cartCount = document.getElementById('cart-count');
    this.cartButton = document.getElementById('cart-button');
    this.cartPopup = document.getElementById('cart-popup');
    this.closeCartButton = document.getElementById('close-cart-button');
    this.confirmationModal = document.getElementById('confirmation-modal');
    this.modalMessage = document.getElementById('modal-message');
    this.confirmButton = document.getElementById('confirm-button');
    this.cancelButton = document.getElementById('cancel-button');

    // wishlist elements (inline)
    this.wishlistBadge = document.getElementById('wishlist-badge');
    this.wishlistInlineBtn = document.getElementById('wishlist-inline-btn');
    this.wishlistInlineHeart = document.getElementById('wishlist-inline-heart');

    // restore wishlist from localStorage
    try {
      const raw = localStorage.getItem('rb_wishlist_v1');
      if (raw) this.wishlist = JSON.parse(raw);
    } catch (_) {}

    // Mobile menu
    this.mobileMenuButton = document.getElementById('mobile-menu-button');
    this.mobileMenu = document.getElementById('mobile-menu');
    
    // Add mobile menu toggle
    this.mobileMenuButton?.addEventListener('click', () => {
      this.mobileMenu.classList.toggle('show');
    });
    
    // Close mobile menu on navigation
    const oldNavigateTo = this.navigateTo;
    this.navigateTo = (page) => {
      this.mobileMenu.classList.remove('show');
      oldNavigateTo.call(this, page);
    };
    
    // Close mobile menu when clicking outside
    document.addEventListener('click', (e) => {
      if (!this.mobileMenuButton.contains(e.target) && 
          !this.mobileMenu.contains(e.target)) {
        this.mobileMenu.classList.remove('show');
      }
    });

    this.addEventListeners();
    this.render();
    this.updateWishlistUI();
  },

  addEventListeners() {
    if (this.searchInput) {
      this.searchInput.addEventListener('input', (e) => this.handleSearch(e.target.value));
    }

    this.cartButton?.addEventListener('click', (e) => { e.stopPropagation(); this.toggleCart(); });
    this.closeCartButton?.addEventListener('click', () => this.toggleCart(false));

    // wishlist inline navigation
    this.wishlistInlineBtn?.addEventListener('click', (e) => { e.stopPropagation(); this.navigateTo('wishlist'); });

    document.addEventListener('click', (e) => {
      const isCartOpen = !this.cartPopup.classList.contains('hidden');
      const isClickInsideCart = this.cartPopup.contains(e.target);
      const isClickOnCartButton = this.cartButton.contains(e.target);
      if (isCartOpen && !isClickInsideCart && !isClickOnCartButton) this.toggleCart(false);
    });

    this.confirmButton?.addEventListener('click', () => {
      if (this.confirmCallback) this.confirmCallback();
      this.hideConfirmation();
    });
    this.cancelButton?.addEventListener('click', () => this.hideConfirmation());
  },

  showConfirmation(message, callback) {
    this.modalMessage.textContent = message;
    this.confirmCallback = callback;
    this.confirmationModal.classList.remove('hidden');
  },
  hideConfirmation() {
    this.confirmationModal.classList.add('hidden');
    this.confirmCallback = null;
  },

  handleSearch(term) {
    this.searchTerm = (term || '').toLowerCase();
    if (this.currentPage !== 'store') this.navigateTo('store');
    else this.renderStorePage();
  },

  navigateTo(page) {
    this.currentPage = page;
    this.render();
    window.scrollTo(0,0);
  },

  addToCart(productId) {
    const product = this.products.find(p => p.id === productId);
    const existing = this.cart.find(i => i.id === productId);
    if (existing) existing.quantity++;
    else this.cart.push({ ...product, quantity: 1 });

    // update UI without full re-render to avoid jumps
    this.updateCartUI();
    this.updateProductCardButtons(productId);

    // small feedback animation
    const card = document.querySelector(`[data-product-id="${productId}"]`);
    if (card) {
      gsap.fromTo(card, { scale: 0.995 }, { scale: 1, duration: 0.18, ease: 'power1.out' });
    }
  },

  removeFromCart(productId) {
    this.cart = this.cart.filter(i => i.id !== productId);
    this.updateCartUI();
    this.updateProductCardButtons(productId);
  },

  increaseCartItem(productId) {
    const item = this.cart.find(i => i.id === productId);
    if (item) { item.quantity++; this.updateCartUI(); this.updateProductCardButtons(productId); }
  },

  decreaseCartItem(productId) {
    const item = this.cart.find(i => i.id === productId);
    if (!item) return;
    if (item.quantity > 1) item.quantity--;
    else this.cart = this.cart.filter(i => i.id !== productId);
    this.updateCartUI();
    this.updateProductCardButtons(productId);
  },

  toggleCart(forceState) {
    if (forceState === true) this.cartPopup.classList.remove('hidden');
    else if (forceState === false) this.cartPopup.classList.add('hidden');
    else this.cartPopup.classList.toggle('hidden');
  },

  updateCartUI() {
    const totalItems = this.cart.reduce((s,i)=>s+i.quantity,0);
    this.cartCount.textContent = totalItems;
    const cartContent = document.getElementById('cart-content');
    const cartTotalEl = document.getElementById('cart-total');
    if (!cartContent) return;
    if (this.cart.length === 0) {
      cartContent.innerHTML = '<p class="text-center text-gray-500">×¡×œ ×”×§× ×™×•×ª ×©×œ×š ×¨×™×§.</p>';
      cartTotalEl.textContent = 'â‚ª0.00';
      return;
    }
    cartContent.innerHTML = this.cart.map(item => `
      <div class="flex items-center mb-4">
        <img src="${item.image}" alt="${item.name}" class="w-16 h-16 object-cover rounded-md">
        <div class="flex-grow pr-3">
          <p class="font-semibold">${item.name}</p>
          <div class="flex items-center text-sm text-gray-600 mt-1">
            <button onclick="event.stopPropagation(); app.decreaseCartItem(${item.id})" class="w-6 h-6 rounded-full border flex items-center justify-center hover:bg-gray-100">-</button>
            <span class="mx-3">${item.quantity}</span>
            <button onclick="event.stopPropagation(); app.increaseCartItem(${item.id})" class="w-6 h-6 rounded-full border flex items-center justify-center hover:bg-gray-100">+</button>
          </div>
        </div>
        <div class="text-right">
          <p class="font-semibold">â‚ª${(item.price*item.quantity).toFixed(2)}</p>
          <button onclick="event.stopPropagation(); app.showConfirmation('×”×× ×œ×”×¡×™×¨ ××ª ×”××•×¦×¨ ××”×¡×œ?', () => app.removeFromCart(${item.id}))" class="text-red-500 hover:text-red-700 text-xs mt-1">×”×¡×¨</button>
        </div>
      </div>`).join('');
    const total = this.cart.reduce((s,i)=>s + (i.price * i.quantity),0);
    cartTotalEl.textContent = `â‚ª${total.toFixed(2)}`;
  },

  // wishlist helpers
  toggleWishlist(productId) {
    const idx = this.wishlist.indexOf(productId);
    const added = idx === -1;
    if (added) this.wishlist.push(productId);
    else this.wishlist.splice(idx,1);
    try { localStorage.setItem('rb_wishlist_v1', JSON.stringify(this.wishlist)); } catch(_) {}
    this.updateWishlistUI();
    this.updateProductWishlistButton(productId);

    // small feedback animation on heart
    const btn = document.querySelector(`[data-product-id="${productId}"] .wishlist-btn`);
    if (btn) gsap.fromTo(btn, { scale: 0.92 }, { scale: 1, duration: 0.18, ease: 'power2.out' });
  },
  isInWishlist(productId) { return this.wishlist.includes(productId); },
  updateWishlistUI() {
    if (!this.wishlistBadge) return;
    const count = this.wishlist.length;
    if (count > 0) {
      this.wishlistBadge.style.display = 'flex';
      this.wishlistBadge.textContent = count;
      if (this.wishlistInlineHeart) this.wishlistInlineHeart.textContent = 'â™¥';
    } else {
      this.wishlistBadge.style.display = 'none';
      if (this.wishlistInlineHeart) this.wishlistInlineHeart.textContent = 'â™¡';
    }
  },

  // update just the product card buttons (avoid full re-render)
  updateProductCardButtons(productId) {
    const el = document.querySelector(`[data-product-id="${productId}"]`);
    if (!el) return;
    const product = this.products.find(p => p.id === productId);
    const inCart = this.cart.find(i=>i.id===productId);
    const buttonHtml = inCart
      ? `<div class="flex justify-center items-center space-x-2 space-x-reverse w-full quantity-controls">
           <button onclick="event.stopPropagation(); app.decreaseCartItem(${product.id})" class="text-xl w-10 h-10 flex items-center justify-center rounded-md bg-red-50 hover:bg-red-100 no-hover">-</button>
           <span class="text-lg px-4">${inCart.quantity}</span>
           <button onclick="event.stopPropagation(); app.increaseCartItem(${product.id})" class="text-xl w-10 h-10 flex items-center justify-center rounded-md bg-green-50 hover:bg-green-100 no-hover">+</button>
         </div>`
      : `<button onclick="event.stopPropagation(); app.addToCart(${product.id})" class="add-to-cart-btn w-full bg-indigo-600 text-white py-2 px-4 rounded hover:bg-indigo-700 transition-colors no-hover">×”×•×¡×£ ×œ×¡×œ</button>`;
    const actions = el.querySelector('.card-actions');
    if (actions) actions.innerHTML = buttonHtml;
  },

  updateProductWishlistButton(productId) {
    const btn = document.querySelector(`[data-product-id="${productId}"] .wishlist-btn`);
    if (!btn) return;
    const inWishlist = this.isInWishlist(productId);
    btn.classList.toggle('filled', inWishlist);
    const heart = btn.querySelector('.heart');
    if (heart) heart.textContent = inWishlist ? 'â™¥' : 'â™¡';
  },

  // render pages
  render() {
    switch(this.currentPage) {
      case 'home': this.renderHomePage(); break;
      case 'store': this.renderStorePage(); break;
      case 'about': this.renderAboutPage(); break;
      case 'contact': this.renderContactPage(); break;
      case 'wishlist': this.renderWishlistPage(); break;
      default: this.renderHomePage();
    }
    this.updateCartUI();
    this.updateWishlistUI();
  },

  renderHomePage() {
    this.mainContent.innerHTML = `
      <div class="text-center">
        <div id="hero" class="bg-indigo-600 text-white py-20 rounded-lg shadow-lg" style="position:relative;overflow:hidden;">
          <div class="hero-content">
            <h1 id="split-heading" class="text-7xl font-bold mb-4 split-parent">×”×§×•×œ×§×¦×™×” ×”×—×“×©×” ×›×‘×¨ ×›××Ÿ</h1>
            <p id="hero-subtitle" class="text-xl mb-8" style="opacity:0; transform: translateY(12px);">×’×œ×• ××ª ×”×¡×˜×™×™×œ ×”×—×“×© ×©×œ×›× ×œ×¢×•× ×” ×”×§×¨×•×‘×”.</p>
            <button id="hero-cta" onclick="event.stopPropagation(); app.navigateTo('store')" class="bg-white text-indigo-600 font-bold py-3 px-8 rounded-full hover-effect no-hover" style="opacity:0; transform: translateY(12px) scale(0.98);">×œ×¨×›×™×©×”</button>
          </div>
          <div id="hero-gradual-blur-placeholder" aria-hidden="true" style="position:absolute;left:0;right:0;bottom:0;height:6rem;pointer-events:none;"></div>
        </div>

        <h2 class="text-3xl font-bold my-12">××•×¦×¨×™× × ×‘×—×¨×™×</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
          ${this.products.slice(0,4).map(p => this.renderProductCard(p)).join('')}
        </div>
      </div>
    `;
    this.animateSplitHeading();
    this.renderGradualBlur('#hero-gradual-blur-placeholder', { position:'bottom', height:'6rem', strength:2, divCount:5, exponential:true, opacity:1 });
  },

  renderStorePage() {
    const filtered = this.products.filter(p => p.name.toLowerCase().includes(this.searchTerm));
    this.mainContent.innerHTML = `
      <h1 class="text-4xl font-bold mb-8 text-center">×›×œ ×”××•×¦×¨×™×</h1>
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
        ${filtered.length ? filtered.map(p => this.renderProductCard(p)).join('') : '<p class="col-span-full text-center text-gray-500">×œ× × ××¦××• ××•×¦×¨×™×.</p>'}
      </div>
    `;
  },

  renderAboutPage() {
    this.mainContent.innerHTML = `<div class="max-w-3xl mx-auto bg-white p-8 rounded-lg shadow-md"><h1 class="text-4xl font-bold mb-6 text-center">××•×“×•×ª×™× ×•</h1><p class="text-lg leading-relaxed text-gray-700">...</p></div>`;
  },

  renderContactPage() {
    this.mainContent.innerHTML = `<div class="max-w-3xl mx-auto bg-white p-8 rounded-lg shadow-md"><h1 class="text-4xl font-bold mb-6 text-center">×¦×•×¨ ×§×©×¨</h1><form class="space-y-6">...</form></div>`;
  },

  renderWishlistPage() {
    const items = this.wishlist.map(id => this.products.find(p => p.id === id)).filter(Boolean);
    this.mainContent.innerHTML = `
      <div class="max-w-5xl mx-auto">
        <h1 class="text-4xl font-bold mb-6 text-center">×¨×©×™××ª ××©××œ×•×ª</h1>
        ${items.length === 0 ? '<p class="text-center text-gray-500">×”×¨×©×™××” ×©×œ×š ×¨×™×§×”.</p>' : `
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            ${items.map(p => `
              <div class="bg-white rounded-lg shadow-md p-4">
                <div class="flex items-center justify-between">
                  <h3 class="font-semibold">${p.name}</h3>
                  <div class="flex items-center gap-2">
                    <button onclick="event.stopPropagation(); app.toggleWishlist(${p.id})" class="text-red-500">×”×¡×¨</button>
                    <button onclick="event.stopPropagation(); app.addToCart(${p.id});" class="bg-indigo-600 text-white px-3 py-1 rounded">×”×•×¡×£ ×œ×¡×œ</button>
                  </div>
                </div>
                <img src="${p.image}" alt="${p.name}" class="w-full h-48 object-cover mt-4 rounded" />
                <div class="mt-3 font-bold">â‚ª${p.price.toFixed(2)}</div>
              </div>`).join('')}
          </div>`}
      </div>
    `;
  },

  renderProductCard(product) {
    const inCart = this.cart.find(i=>i.id===product.id);
    const inWishlist = this.isInWishlist(product.id);
    const buttonHtml = inCart
      ? `<div class="flex justify-center items-center space-x-2 space-x-reverse w-full quantity-controls">
           <button onclick="event.stopPropagation(); app.decreaseCartItem(${product.id})" class="text-xl w-10 h-10 flex items-center justify-center rounded-md bg-red-50 hover:bg-red-100 no-hover">-</button>
           <span class="text-lg px-4">${inCart.quantity}</span>
           <button onclick="event.stopPropagation(); app.increaseCartItem(${product.id})" class="text-xl w-10 h-10 flex items-center justify-center rounded-md bg-green-50 hover:bg-green-100 no-hover">+</button>
         </div>`
      : `<button onclick="event.stopPropagation(); app.addToCart(${product.id})" class="add-to-cart-btn w-full bg-indigo-600 text-white py-2 px-4 rounded hover:bg-indigo-700 transition-colors no-hover">×”×•×¡×£ ×œ×¡×œ</button>`;

    return `
      <div class="product-card bg-white rounded-lg shadow-md overflow-hidden hover-effect" data-product-id="${product.id}">
        <div style="position:relative;">
          <img src="${product.image}" alt="${product.name}" class="w-full h-48 object-cover">
          <button onclick="event.stopPropagation(); app.toggleWishlist(${product.id})" class="wishlist-btn no-hover ${inWishlist ? 'filled' : ''}" title="×”×•×¡×£/×”×¡×¨ ××”×¨×©×™××”">
            <span class="heart">${inWishlist ? 'â™¥' : 'â™¡'}</span>
          </button>
        </div>
        <div class="p-4">
          <h3 class="text-lg font-semibold text-center">${product.name}</h3>
          <p class="text-gray-600 mt-1 text-center">â‚ª${product.price.toFixed(2)}</p>
          <div class="mt-4 card-actions">${buttonHtml}</div>
        </div>
      </div>
    `;
  },

  // Split heading animation
  animateSplitHeading() {
    const el = document.getElementById('split-heading');
    if (!el) return;
    if (el.dataset.rbanimated === '1') return;
    const text = el.textContent;
    const chars = Array.from(text).map(ch => ch === ' ' ? `<span class="split-char">&nbsp;</span>` : `<span class="split-char">${ch}</span>`).join('');
    el.innerHTML = chars;
    requestAnimationFrame(()=> {
      const targets = el.querySelectorAll('.split-char');
      gsap.fromTo(targets,
        { opacity: 0, y: 40 },
        { opacity: 1, y: 0, duration: 0.6, ease: 'power3.out', stagger: 0.1,
          onComplete: ()=> { el.dataset.rbanimated='1'; this.animateSubtitleAndCTA(); }
        });
    });
  },

  animateSubtitleAndCTA() {
    const subtitle = document.getElementById('hero-subtitle');
    const cta = document.getElementById('hero-cta');
    const tl = gsap.timeline();
    if (subtitle) tl.to(subtitle, { opacity:1, y:0, duration:0.6, ease:'power3.out' }, 0);
    if (cta) tl.to(cta, { opacity:1, y:0, scale:1, duration:0.7, ease:'back.out(1.4)' }, subtitle ? '+=0.12' : 0);
  },

  // renderGradualBlur: create overlay but keep it under hero content (z-index 0)
  renderGradualBlur(placeholderSelector, opts = {}) {
    const defaults = { 
      target: 'parent',
      position: 'bottom', 
      height: '6rem', 
      strength: 2, 
      divCount: 5,
      curve: 'bezier',
      exponential: true, 
      opacity: 1 
    };
    const cfg = Object.assign({}, defaults, opts);
    
    const placeholder = document.querySelector(placeholderSelector);
    if (!placeholder) return;
    
    // Remove existing blur if present
    const existing = placeholder.querySelector('.gradual-blur');
    if (existing) existing.remove();

    // Create wrapper
    const wrap = document.createElement('div');
    wrap.className = 'gradual-blur';
    wrap.style.cssText = `
      position: absolute;
      height: ${cfg.height};
      ${cfg.position}: 0;
      left: 0;
      right: 0;
      pointer-events: none;
      z-index: 1;
      isolation: isolate;
    `;

    // Create inner container
    const inner = document.createElement('div');
    inner.className = 'gradual-blur-inner';
    inner.style.cssText = `
      position: relative;
      height: 100%;
      width: 100%;
      display: flex;
      flex-direction: ${cfg.position === 'bottom' ? 'column-reverse' : 'column'};
    `;

    // Create blur layers
    for (let i = 0; i < cfg.divCount; i++) {
      const div = document.createElement('div');
      const progress = (i + 1) / cfg.divCount;
      
      // Calculate blur intensity using specified curve
      let t;
      if (cfg.curve === 'bezier') {
        t = progress * progress * (3 - 2 * progress); // Smooth bezier
      } else if (cfg.exponential) {
        t = Math.pow(progress, 2);
      } else {
        t = progress;
      }

      const blurPx = (t * cfg.strength * 6).toFixed(2);
      const layerOpacity = Math.min(0.18, 0.02 + t * 0.12);

      div.style.cssText = `
        flex: 1;
        background: linear-gradient(
          180deg, 
          rgba(255,255,255,${0.0 + t * 0.02}) 0%,
          rgba(255,255,255,${0.02 + t * 0.03}) 100%
        );
        backdrop-filter: blur(${blurPx}px);
        -webkit-backdrop-filter: blur(${blurPx}px);
        opacity: ${layerOpacity};
        pointer-events: none;
        transform-origin: center;
        transition: opacity 0.2s ease;
      `;

      inner.appendChild(div);
    }

    wrap.appendChild(inner);
    placeholder.appendChild(wrap);

    // Setup parent container if target is 'parent'
    if (cfg.target === 'parent') {
      const parent = placeholder.closest('#hero');
      if (parent) {
        parent.style.position = 'relative';
        parent.style.overflow = 'hidden';
      }
    }
  }
};

document.addEventListener('DOMContentLoaded', () => app.init());
</script>

</body>
</html>

